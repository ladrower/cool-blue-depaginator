/*! cool-blue-depaginator v0.0.1 */
!function(a,b,c,d,e){"use strict";function f(a){this.$frame=a,this.rect=null,this.handler={scroll:i.proxy(this.onScroll,this),resize:i.proxy(this.onResize,this)},this.onThresholdReached=d,this.onFrameScrolled=d,this.onResized=d}function g(a,b){this.$context=a,this.selectors=new p(b),this.reset()}function h(a){this.worker=a,this.selectors=e,this.vpObserver=e,this.paging=e,this.isLoading=!1,this.loader=e,this.$header=e,this.$container=e,this.bindLazyLoadingImages=e,l.logV("constructed Depaginator:",this.worker.get("id"))}var i=b.jQuery,j=i(b),k=b[c],l=k.exports.util,m=k.exports.classes,n=m.Abstract.extend({attributes:{},constructor:function(a){var b=this;this.data={},i.each(this.attributes,function(c,d){b.data[c]=void 0!==a[c]?a[c]:d}),m.Abstract.apply(this,arguments)},set:function(a,b){this.data[a]=b},get:function(a){return this.data[a]}}),o=n.extend({attributes:{header:"",container:"",list:""}}),p=n.extend({attributes:{pagingHeader:"",pagingFooter:"",pages:"",current:"",next:"",itemsPerPage:""}}),q=n.extend({attributes:{number:0,url:e,dom:null}});return f.prototype={turnOn:function(a,b,c){return this.isOn()&&this.turnOff(),k.cursor.request(this.handler),this.onThresholdReached=a||d,this.onFrameScrolled=b||d,this.onResized=c||d,this},turnOff:function(){return k.cursor.release(this.handler)&&(this.onThresholdReached=d,this.onFrameScrolled=d,this.onResized=d),this},isOn:function(){return!!k.cursor.findRequester(this.handler)},onScroll:function(a){this.observe(a),this.onFrameScrolled(this.rect.top)},onResize:function(a){this.observe(a),this.onResized()},observe:function(a){this.rect=this.$frame[0].getBoundingClientRect(),this.rect.bottom<1.5*a.vpH&&this.onThresholdReached()},trigger:function(){return i.each(this.handler,function(a){j.trigger(a)}),this}},g.POSITION={FIXED:"fixed",STATIC:"static"},g.prototype={getContainer:function(a){return(a||this.$context).find(this.selectors.get("pagingHeader")).first()},adjustDimensions:function(a){this.getContainer().css({"float":"left",width:this.$context.width(),top:a})},bindEvents:function(){this.getContainer().find(this.selectors.get("pages")).on("click",i.proxy(this.onPageNumberClicked,this))},reposition:function(a){if(this.position!==a){var b=this.getContainer();switch(a){case g.POSITION.FIXED:this.$context.css({"padding-top":b.height()});break;case g.POSITION.STATIC:this.$context.css({"padding-top":0});break;default:return}b.css("position",a),this.position=a}},reset:function(){var a=this.getContainer();return a.css({"z-index":5,"background-color":"#fff"}),this.$context.find(this.selectors.get("pagingFooter")).remove(),this.position=e,this._pages=[],this._current=0,this._itemsPerPage=this.$context.find(this.selectors.get("itemsPerPage")).val(),this.bindEvents(),this},hasNext:function(){return!!this._pages[this._current+1]},next:function(){return this._pages[++this._current]},onPageNumberClicked:function(a){var b=1*a.target.innerHTML;return null!==this.getPage(b)?(this.scrollToPage(b),!1):void(this.position===g.POSITION.FIXED&&this.scrollToPage(0))},scrollToPage:function(a){var b=a?function(a){return 0}(this):this.$context.offset().top-parseInt(this.getContainer().css("top"));return i("html, body").animate({scrollTop:b},100).promise()},collectPagingData:function(){var a=1*this.$context.find(this.selectors.get("current")).text(),c=this.$context.find(this.selectors.get("next")),d=this.getPage(a);d||(d=new q({number:a,url:b.location.toString()}),this._pages.push(d)),c.length&&this._pages.push(new q({number:a+1,url:c[0].href})),d.set("dom",this.getContainer())},getPage:function(a){return i.grep(this._pages,function(b){return b.get("number")===a})[0]||null}},h.prototype={init:function(a){return this.selectors=new o(a),this.$header=i(this.selectors.get("header")),this.$container=i(this.selectors.get("container")),this.offsetTop=this.$header.height(),this.paging=new g(this.$container,a),this.overrideNative(),this.paging.getContainer().length&&(this.vpObserver=new f(this.$container),this.vpObserver.turnOn(i.proxy(this.onRequestNextPage,this),i.proxy(this.onContainerScrolled,this),i.proxy(this.onViewportResized,this)).trigger()),this},overrideNative:function(){var a=this;this.bindLazyLoadingImages=b.bindLazyLoadingImages||d,b.bindLazyLoadingImages=function(){return a.onAfterPageReloaded(),a.bindLazyLoadingImages()}},onContainerScrolled:function(a){this.paging.reposition(a-this.offsetTop<=0?g.POSITION.FIXED:g.POSITION.STATIC)},onViewportResized:function(){this.offsetTop=this.$header.height(),this.paging.adjustDimensions(this.offsetTop)},onRequestNextPage:function(){var a,c=this,d=this.selectors.get("list");this.isLoading||(this.paging.collectPagingData(),this.paging.hasNext()&&(this.isLoading=!0,a=this.paging.next(),c.loader=new m.DfdLite,i.get(a.get("url")).then(i.proxy(c.loader.resolve,c.loader),i.proxy(c.loader.reject,c.loader)),c.loader.promise().done(function(e){var f=i(e);c.$container.find(d).append(f.find(d).children()),a.set("dom",c.paging.getContainer(f)),c.$container.find(".paging-header").first().empty().append(a.get("dom").children()),b.history.pushState(null,null,a.get("url")),c.paging.bindEvents(),c.bindLazyLoadingImages()}).always(function(){c.isLoading=!1})))},onAfterPageReloaded:function(){this.loader&&(this.loader.reject(),this.loader=e),this.paging.reset(),this.vpObserver.trigger()}},k.Depaginator=h}(document,window,window.__CoolblueNamespace__,function(){});