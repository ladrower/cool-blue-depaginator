/*! cool-blue-depaginator v0.0.1 */
!function(a,b,c,d,e){"use strict";function f(){this.init.apply(this,arguments)}function g(a,b){this._baseUrl=b||g.baseUrl,this._collection=a,this._path=""}function h(){this._state=h.STATE.PENDING,this._data=e,this._onResolvedCbs=[],this._onRejectedCbs=[],this._onFinallyCbs=[]}function i(){function i(){this.requesters=[],this.isListening=!1,this.data={scrollX:0,scrollY:0,pageX:0,pageY:0,vpW:0,vpH:0,target:null},this.onScroll=v(i.minFPS,this.onScroll,this),this.onResize=v(i.minFPS,this.onResize,this),this.onMouseMove=v(i.minFPS,this.onMouseMove,this),this.onMouseDown=v(i.minFPS,this.onMouseDown,this),this.onClick=v(i.minFPS,this.onClick,this)}function j(a){this.items=a}function n(a,b){this.tasks=a,this.wFactory=b,this.inProcess=!1,this.reschedule=!1}function p(a,b){this._fields={":id":a,":name":b||p.factory.defaultName},this._collectors=[]}function s(a){this.executor=a,this.client=e}var w,x=l(b),B=l(a);return k=f.extend({constructor:function(a){if(!(a instanceof p))throw new Error("The first argument should be an instance of Worker");this.worker=a,f.apply(this,arguments)},hitTypes:[],collect:function(){return this},serialize:function(){return{}}}),i.minFPS=10,i.Requester=function(a,b){this.handler=a,this.fps=b||i.minFPS,this.mousemove=a.mousemove?v(this.fps,a.mousemove):r(a)?v(this.fps,a):d,this.mousedown=a.mousedown?v(this.fps,a.mousedown):d,this.click=a.click?v(this.fps,a.click):d,this.scroll=a.scroll?v(this.fps,a.scroll):d,this.resize=a.resize?v(this.fps,a.resize):d},i.prototype={request:function(){return this.requesters.push(u(i.Requester,arguments)),this.apply(),this},release:function(a){for(var b,c=!1;-1!==(b=l.inArray(this.findRequester(a),this.requesters));)this.requesters.splice(b,1),c=!0;return c&&this.apply(),c},findRequester:function(a){return l.grep(this.requesters,function(b){return b.handler===a})[0]||null},getMaxFPS:function(){return b.Math.max.apply(null,l.map(this.requesters,function(a){return a.fps}).concat(i.minFPS))},apply:function(){if(this.requesters.length){var a=this.getMaxFPS();this.onScroll.setFPS(a),this.onResize.setFPS(a),this.onMouseMove.setFPS(a),this.onMouseDown.setFPS(a),this.onClick.setFPS(a),this.updateScrollData(),this.updateViewportData(),this.addEventListeners()}else this.removeEventListeners();return this},notify:function(a){var b=this.data;l.each(this.requesters,function(c,d){d&&d[a](b)})},updateViewportData:function(){this.data.vpW=x.width(),this.data.vpH=x.height()},updateScrollData:function(){this.data.scrollX=b.pageXOffset!==e?b.pageXOffset:(a.documentElement||a.body.parentNode||a.body).scrollLeft,this.data.scrollY=b.pageYOffset!==e?b.pageYOffset:(a.documentElement||a.body.parentNode||a.body).scrollTop},updateCursorData:function(a){this.data.pageX=a.pageX,this.data.pageY=a.pageY,this.data.target=a.target},addEventListeners:function(){this.isListening||(x.on("scroll",this.onScroll),x.on("resize",this.onResize),B.on("mousemove",this.onMouseMove),B.on("mousedown",this.onMouseDown),B.on("click",this.onClick),this.isListening=!0)},removeEventListeners:function(){x.off("scroll",this.onScroll),x.off("resize",this.onResize),B.off("mousemove",this.onMouseMove),B.off("mousedown",this.onMouseDown),B.off("click",this.onClick),this.isListening=!1},onScroll:function(){this.updateScrollData(),this.notify("scroll")},onResize:function(){this.updateViewportData(),this.notify("resize")},onMouseMove:function(a){this.updateCursorData(a),this.notify("mousemove")},onMouseDown:function(a){this.updateCursorData(a),this.notify("mousedown")},onClick:function(a){this.updateCursorData(a),this.notify("click")}},j.prototype={clear:function(){this.items.length=0},get:function(a){return this.items[a]},add:function(a){this.items.push(a)},remove:function(a){(a=l.inArray(a,this.items))>=0&&this.items.splice(a,1)},size:function(){return this.items.length},last:function(){return this.get(this.size()-1)}},n.COMMAND={SET:"set",DEFAULTS:"defaults",CREATE:"create",SEND:"send",WAIT:"wait"},n.prototype={processTasks:function(){var a,b=this,c=this.tasks,d=c.size(),f=[],g=[];if(d)if(b.inProcess)b.reschedule=!0;else{D("scheduling tasks: "+d),b.inProcess=!0;var i=function(a){var c=b.processTask(a);c&&(g.push(c),h.when(c).done(function(){f.push(a),D("processed task",a),a.cb&&t(a.cb,e,[a.worker])}))};for(a=0;d>a;)i(c.get(a++));h.all(g).always(function(){for(D(f.length+" done"),a=0;a<f.length;)c.remove(f[a++]);D(c.size()+" left",c),b.inProcess=!1,b.reschedule&&(D("rescheduling"),b.reschedule=!1,b.processTasks())})}},processTask:function(a){var b,c=a[0],d=o.call(a,1);try{if(l.isFunction(c))return c(this.wFactory.get());if(b=c.split("."),c=b[1]||c,c===n.COMMAND.CREATE)return a.worker=this.wFactory.create.apply(this.wFactory,d);switch(a.worker=b.length>1?this.wFactory.getByName(b[0]):this.wFactory.get(),c){case n.COMMAND.SEND:return p.processor.send(a.worker,d);case n.COMMAND.SET:return p.processor.set(a.worker,d);case n.COMMAND.DEFAULTS:return p.processor.set(a.worker,d,!0);case n.COMMAND.WAIT:return p.processor.wait(a.worker,d);default:return!1}}catch(e){return C(e),!1}return!0}},p.resource=new g("collect",e),p.factory={cursorT:new i,defaultName:"w0",defaultW:null,storage:[],create:function(){var a=u(p,arguments);try{a.addCollector(new p.BaseCollector(a).collect()),a.addCollector(new p.DeviceCollector(a).collect()),a.addCollector(new p.EventCollector(a).collect())}catch(b){C(b)}return this.storage.push(a),a},getByName:function(a){return l.grep(p.factory.storage,function(b){return b.get("name")===a})[0]||null},get:function(){return this.defaultW?this.defaultW:this.defaultW=this.storage[0]||null}},p.HIT={PAGEVIEW:"pageview",EVENT:"event",MOUSETRACK:"mousetrack"},p.generateCID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},p.BaseCollector=k.extend({collect:function(){var c=b.location.protocol+"//"+b.location.hostname+b.location.pathname+b.location.search;return this.worker.set({clientId:A.getItem(z.CLIENT)||p.generateCID(),referrer:a.referrer,location:c,title:a.title}),this},serialize:function(){return{wid:this.worker.get("id"),cid:this.worker.get("clientId"),dr:this.worker.get("referrer"),dl:this.worker.get("location"),dt:this.worker.get("title")}}}),p.DeviceCollector=k.extend({collect:function(){return this.worker.set("device",{screenWidth:b.screen.width,screenHeight:b.screen.height,viewWidth:x.width(),viewHeight:x.height(),language:b.navigator.language,userAgent:b.navigator.userAgent}),this},serialize:function(){var a=this.worker.get("device");return{d:a&&{w:a.screenWidth,h:a.screenHeight,vw:a.viewWidth,vh:a.viewHeight,l:a.language,ua:a.userAgent}||{}}}}),p.EventCollector=k.extend({hitTypes:[p.HIT.EVENT],collect:function(){return this},serialize:function(){var a=this.worker.get("event");return a&&{ec:a.c,ea:a.a,ev:a.v}||{}}}),p.serialize=function(a,b){var c={};return l.each(b._collectors,function(b,d){d.hitTypes.length&&-1===l.inArray(a,d.hitTypes)||l.extend(c,d.serialize())}),c},p.processor={set:function(a,b,c){var d,f=this,g=b[0],h=b[1];return q(g)?l.each(g,function(b,d){f.set(a,[b,d],c)}):(d=a._fields[":"+g],a._fields[":"+g]=c&&d!==e?d:h),this},send:function(a,b){var c,d=b[0];switch(d){case p.HIT.PAGEVIEW:c=p.resource.create(p.serialize(d,a),{hitType:d});break;case p.HIT.EVENT:c=this._sendEvent(a,b[1],b[2],b[3]);break;default:return!1}return c.done(function(){A.setItem(z.CLIENT,a.get("clientId"),new Date(1*new Date+63072e6)),D("sent hit ["+d+"] for worker ["+a.get("id")+'] "'+a.get("name")+'"')})},wait:function(a,b){for(var c=0,d=b.length,e=[],f=(a.get("id"),function(b){switch(b){case y.DEPAGINATOR:e.push(l.when(0,F(b).done(function(){a.depaginator||(a.depaginator=new w.client.Depaginator(a))})).then(function(){return a.depaginator}))}});d>c;)f(b[c++]);return l.when.apply(l,e)},_sendEvent:function(a,b,c,d){var f=p.serialize(p.HIT.EVENT,a.set("event",{c:b,a:c,v:d}));return a.set("event",e),p.resource.create(f,{hitType:p.HIT.EVENT})}},p.prototype={get:function(a){return this._fields[":"+a]},set:function(){return p.processor.set(this,arguments),this},defaults:function(){return p.processor.set(this,arguments,!0),this},send:function(){return p.processor.send(this,arguments)},wait:function(){return p.processor.wait(this,arguments)},addCollector:function(a){if(!(a instanceof k))throw new Error("argument should be an instance of Collector");return this._collectors.push(a),this}},s.prototype={init:function(){return D("initializing with jQuery v"+l.fn.jquery),t(function(){this.executor.processTasks()},this),this.client=function(){return w.executor.tasks.add(arguments),w.executor.processTasks(),{then:function(a){w.executor.tasks.last().cb=a}}},this.client.getByName=this.executor.wFactory.getByName,this.client.getAll=function(){return w.executor.wFactory.storage.slice()},this.client.cursor=this.executor.wFactory.cursorT,this}},b[c]=(w=new s(new n(new j(m.q),p.factory))).init().client}var j,k,l=b.jQuery,m=(b.location,b[c]),n={},o=Array.prototype.slice,p=Object.prototype.hasOwnProperty,q=function(a){return null!==a&&"object"==typeof a},r=function(a){return"function"==typeof a},s=function(a){return q(a)&&r(a.promise)&&!h.isThis(a)},t=function(a,b,c){setTimeout(function(){a.apply(b,c)},0)},u=function(a,b){var c=function(){};c.prototype=a.prototype,c.prototype.constructor=a;var d=new c;return a.apply(d,b),d},v=function(a,b,c){function d(){function a(){g=1*new Date,b.apply(c,h)}var d=new Date-g,h=arguments;return e&&clearTimeout(e),d>f?a():e=setTimeout(a,f-d)}var e,f,g=0;return d.setFPS=function(a){f=1e3/a},d.setFPS(a),d},w=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,!c&&a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},x=function(){var a=0;return function(){return a++}}(),y={JSON:"json2",JQUERY:"jquery",DEPAGINATOR:"depaginator"},z={CLIENT:"_COOL_BLUE_CID"},A={getItem:function(b){return b?decodeURIComponent(a.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(b,c,d,e,f,g){if(b&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(b)){var h="";if(d)switch(d.constructor){case Number:h=d===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+d;break;case String:h="; expires="+d;break;case Date:h="; expires="+d.toUTCString()}a.cookie=encodeURIComponent(b)+"="+encodeURIComponent(c)+h+(f?"; domain="+f:"")+"; path="+(e||"/")+(g?"; secure":"")}},removeItem:function(b,c,d){this._hasItem(b)&&(a.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(d?"; domain="+d:"")+(c?"; path="+c:""))},_hasItem:function(b){return b?new RegExp("(?:^|;\\s*)"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(a.cookie):!1}},B=function(a){b.console&&b.console[a]&&function(b,d){var e=[c,"["+(new Date-m.t)/1e3+"s]"];e.push.apply(e,d),b[a].apply(b,e)}(b.console,o.call(arguments,1)[0])},C=function(){B("error",arguments)},D=function(){m.debug&&B("log",arguments)},E=function(a){var c=a.split(":");return n[a]=function(){switch(c[0]){case y.JQUERY:return G(m.cdn+"lib/jquery-1.11.3.min.js",function(){return b.jQuery});case y.JSON:return G(m.cdn+"polyfill/json2.min.js",function(){return b.JSON});case y.DEPAGINATOR:return G(m.cdn+"depaginator.js")}}()},F=function(){for(var a,b=[],c=0;c<arguments.length;)a=arguments[c++],b.push(n[a]||E(a));return h.all(b)},G=function(b,c){var d=a.createElement("script"),e=a.getElementsByTagName("head")[0],f=0,g=new h;return d.async=1,d.src=b,d.onload=d.onreadystatechange=function(){f||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,g.resolve(c&&c()),d.onload=d.onreadystatechange=null,e.removeChild(d))},e.appendChild(d),h.when(g)};return f.prototype.init=function(){},f.extend=function(a,b){var c,d=this;c=a&&p.call(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},l.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&l.extend(c.prototype,a),c._super=d.prototype,c},g.baseUrl=m.api,g.METHOD={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},g.prototype={one:function(a,b){return this._path+="/"+a+(b?"/"+b:""),this},all:function(a){return this._path+="/"+a,this},getAll:function(a,b){return this.send(g.METHOD.GET,e,e,a,b)},get:function(a,b,c){return this.send(g.METHOD.GET,a,e,b,c)},update:function(a,b,c,d){return this.send(g.METHOD.PUT,a,b,c,d)},create:function(a,b,c){return this.send(g.METHOD.POST,e,a,b,c)},remove:function(a,b,c){return this.send(g.METHOD.DELETE,a,e,b,c)},send:function(a,c,d,e,f){var g=this._baseUrl+this._collection+this._path;return c&&(g+="/"+c),e&&(g+="?"+l.param(e)),this._path="",l.ajax(l.extend({url:g,method:a,type:a,data:b.JSON.stringify(d),contentType:"application/json"},f))}},h.STATE={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},h.isThis=function(a){return a instanceof h},h.when=function(a){if(s(a))return a;var b=h.isThis(a)?a:(new h).resolve(a);return{progress:d,promise:function(){return this},state:function(){return b._state},done:function(a){return b._onResolvedCbs.push(a),b._state===h.STATE.RESOLVED&&b._onResolved(),this},fail:function(a){return b._onRejectedCbs.push(a),b._state===h.STATE.REJECTED&&b._onRejected(),this},always:function(a){return b._onFinallyCbs.push(a),b._state!==h.STATE.PENDING&&b._onAlways(),this}}},h.checkAllResolved=function(a){for(var b,c=0;c<a.length;)if(b=a[c++],(s(b)||h.isThis(b))&&b.state()!==h.STATE.RESOLVED)return!1;return!0},h.getValuesRef=function(a){for(var b=[],c=0,d=function(c){var d=a[c];s(d)||h.isThis(d)?(d.done(function(a){b[c]=a}),d.fail(function(a){b[c]=a})):b[c]=d};c<a.length;)d(c++);return b},h.all=function(a){var b=new h,c=0,d=this.getValuesRef(a),e=function(){b.state()===h.STATE.PENDING&&b.reject(d)},f=function(){b.state()===h.STATE.PENDING&&h.checkAllResolved(a)&&b.resolve(d)};for(h.checkAllResolved(a)&&b.resolve(d);c<a.length;)h.when(a[c++]).fail(e).done(f);return h.when(b)},h.prototype={promise:function(){return h.when(this)},state:function(){return this._state},resolve:function(a){return this._state=h.STATE.RESOLVED,this._data=a,this._onResolved(),this},reject:function(a){return this._state=h.STATE.REJECTED,this._data=a,this._onRejected(),this},_onResolved:function(){this._executeCallbacks(this._onResolvedCbs,this._data),this._onAlways()},_onRejected:function(){this._executeCallbacks(this._onRejectedCbs,this._data),this._onAlways()},_onAlways:function(){this._executeCallbacks(this._onFinallyCbs),this._onResolvedCbs.length=0,this._onRejectedCbs.length=0,this._onFinallyCbs.length=0},_executeCallbacks:function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].call(this,b)}},function(){h.all([function(){var a=l&&l.fn&&l.fn.jquery&&l.fn.jquery.split(".");return a&&1*a[0]>0&&1*a[1]>=8&&l}()||E(y.JQUERY),function(){return"undefined"!=typeof b.JSON&&b.JSON}()||E(y.JSON),b.sessionStorage||A]).done(function(a){var b=a[0];j=a[2];try{l!==b&&(l=b.noConflict()),G=function(a,c){return b.ajax({dataType:"script",cache:!0,url:a}).then(c)},i().exports={cdn:m.cdn,api:m.api,util:{async:t,framed:v,debounce:w,logV:D,loadScript:G,clientStorage:j,uniqueCID:x},classes:{Abstract:f,Collector:k,Resource:g,DfdLite:h}}}catch(c){C(c)}})}()}(document,window,window.__CoolblueNamespace__,function(){});